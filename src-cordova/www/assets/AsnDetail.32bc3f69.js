import{Q as f}from"./QItemLabel.6b69de3f.js";import{Q as oe,a as A,b as V}from"./QList.88c3db1c.js";import{_ as le,aC as ie,J as ue,aR as ce,r as _,c as s,w,o as de,M as N,Y as T,f as t,R as n,aS as re,F as B,W as r,X as d,$ as Y,Z as ge,aT as me,V as Z,S as z,O as pe,m as I,aU as fe,aD as be,aV as ve,Q as he,aW as _e,a1 as ye}from"./index.0a98aec3.js";import{Q as Ce,a as Se,b as Qe}from"./QBar.188bbb65.js";import{Q as De}from"./QSelect.ac2ad5be.js";import{C as $e}from"./ClosePopup.88fe7425.js";import{u as ke}from"./use-quasar.278686c4.js";import{a as O}from"./index.33b22a2c.js";import{u as Ve}from"./vue-i18n.runtime.esm-bundler.780b764a.js";import"./selection.4efaf22f.js";import"./QMenu.f282bd8a.js";import"./rtl.b51694b1.js";import"./format.a33550d6.js";import"./axios.b70a614d.js";const we=ie({name:"ASNDetail",data(){return{}},setup(){const e=ue();ce();const l=ke(),b=_(0),m=_({}),y=_(!1),C=_([]),o=_(""),{t:c}=Ve(),U=s({get:()=>e.state.fabchange.fab1}),H=s({get:()=>e.state.fabchange.fab2}),K=s({get:()=>e.state.fabchange.fab3}),x=s({get:()=>e.state.fabchange.fab4}),E=s({get:()=>e.state.screenchange.screenscroll}),q=s({get:()=>e.state.loginauth.authin}),ee=s({get:()=>e.state.loginauth.login_name}),S=s({get:()=>e.state.loginauth.operator}),Q=s({get:()=>e.state.settings.openid}),D=s({get:()=>e.state.langchange.lang}),v=s({get:()=>e.state.settings.server}),M=s({get:()=>e.state.scanchanged.scandata,set:a=>{e.commit("scanchanged/ScanChanged",a)}}),ae=s({get:()=>e.state.scanchanged.datadetail,set:a=>{e.commit("scanchanged/ScanDataChanged",a)}}),j=s({get:()=>e.state.scanchanged.asndata,set:a=>{e.commit("scanchanged/ASNDataChanged",a)}}),te=s({get:()=>e.state.scanchanged.dndata,set:a=>{e.commit("scanchanged/DNDataChanged",a)}}),ne=s({get:()=>e.state.scanchanged.bindata,set:a=>{e.commit("scanchanged/BinDataChanged",a)}}),h=s({get:()=>e.state.scanchanged.tablelist,set:a=>{e.commit("scanchanged/TableDataChanged",a)}}),$=s({get:()=>e.state.scanchanged.scanmode,set:a=>{e.commit("scanchanged/ScanModeChanged",a)}}),L=s({get:()=>e.state.scanchanged.bar_scanned}),g=s({get:()=>e.state.scanchanged.apiurl,set:a=>{e.commit("scanchanged/ApiUrlChanged",a)}}),k=s({get:()=>e.state.scanchanged.apiurlnext,set:a=>{e.commit("scanchanged/ApiUrlNextChanged",a)}}),J=s({get:()=>e.state.scanchanged.apiurlprevious,set:a=>{e.commit("scanchanged/ApiUrlPreviousChanged",a)}});function R(a){if(a!==null){var i=v.value.split(":"),u=a.split(":");return i[0]!==u[0]?i[0]+":"+u[1]:u}else return null}function F(a){h.value=[],g.value=v.value+"/asn/detail/?asn_status=4&asn_code="+j.value,P(a)}function P(a){O.get(g.value+a,{headers:{"Content-Type":'application/json, charset="utf-8"',token:Q.value,language:D.value,operator:S.value}}).then(i=>{if(i.data.detail)l.notify({type:"negative",message:c("notice.mobile_scan.notice1")});else{var u=[];h.value.forEach(p=>{u.push(p)}),i.data.results.forEach(p=>{u.push(p)}),h.value=u,J.value=R(i.data.previous),k.value=R(i.data.next)}}).catch(i=>{l.notify({type:"negative",message:c("notice.mobile_scan.notice3")})})}function W(a){m.value=JSON.parse(JSON.stringify(a)),Object.assign(m.value,{qty:"",bin_name:""}),y.value=!0}function G(){y.value=!1}function se(){m.value.bin_name===""?l.notify({type:"negative",message:c("notice.mobile_asn.notice13")}):(g.value=v.value+"/asn/movetobin/",O.post(g.value+m.value.id+"/",m.value,{headers:{"Content-Type":"application/json",token:Q.value,language:D.value,operator:S.value}}).then(a=>{a.data.detail||l.notify({message:c("notice.mobile_asn.notice12")}),G(),F("")}).catch(a=>{l.notify({message:c("notice.network_error")})}))}function X(a){g.value=v.value+"/binset/?bin_name__icontains=",O.get(g.value+a,{headers:{"Content-Type":'application/json, charset="utf-8"',token:Q.value,language:D.value,operator:S.value}}).then(i=>{if(!i.data.detail){var u=[];C.value=[],i.data.results.forEach(p=>{u.push(p.bin_name)}),C.value=u}}).catch(i=>{l.notify({type:"negative",message:c("notice.mobile_scan.notice3")})})}return w(o,(a,i)=>{a.length>=2&&X(a)}),w(L,(a,i)=>{$.value==="GOODS"?h.value.forEach(u=>{u.goods_code===M.value&&W(u)}):$.value==="ASN"&&F("")}),w(E,(a,i)=>{a===1?k.value!==null&&(g.value=k.value,b.value=1):b.value=0}),w(b,(a,i)=>{a===1&&(q.value==="0"?l.notify({type:"negative",message:c("notice.mobile_userlogin.notice9")}):P(""))}),de(()=>{q.value==="0"?l.notify({type:"negative",message:c("notice.mobile_userlogin.notice9")}):($.value="ASN",F(""))}),{t:c,fab1:U,fab2:H,fab3:K,fab4:x,screenscroll:E,authin:q,login_name:ee,openid:Q,operator:S,lang:D,requestauth:b,baseurl:v,apiurl:g,apiurlnext:k,apiurlprevious:J,scandata:M,datadetail:ae,tablelist:h,asndata:j,dndata:te,bindata:ne,scanmode:$,bar_scanned:L,submitdata:m,dialogForm:y,dataSubmit:W,cancelDataSubmit:G,submitData:se,options:C,optionsChange:o,moveerror:c("notice.mobile_asn.notice11"),setOptions:X,filterFn(a,i,u){if(a.length<2){u();return}i(()=>{const p=a.toLowerCase();o.value=p})}}}}),Ne={style:{float:"right",padding:"15px 15px 15px 0"}};function qe(e,l,b,m,y,C){return N(),T(B,null,[t(oe,{bordered:"",padding:""},{default:n(()=>[t(A,null,{default:n(()=>[t(V,null,{default:n(()=>[t(f,{overline:""},{default:n(()=>[r(d(e.$t("notice.mobile_asn.notice6")),1)]),_:1}),t(f,{caption:""},{default:n(()=>[r(d(e.$t("notice.mobile_asn.notice7")),1)]),_:1})]),_:1})]),_:1}),t(Y,{spaced:""}),(N(!0),T(B,null,ge(e.tablelist,(o,c)=>(N(),T(B,{key:c},[t(A,null,{default:n(()=>[t(V,{onClick:U=>e.dataSubmit(o)},{default:n(()=>[t(f,null,{default:n(()=>[r(d(o.asn_code),1)]),_:2},1024),t(f,{caption:"",lines:"2"},{default:n(()=>[r(d(o.goods_code),1)]),_:2},1024)]),_:2},1032,["onClick"]),t(V,{side:"",top:""},{default:n(()=>[t(f,{caption:""},{default:n(()=>[r(d(e.$t("notice.mobile_asn.notice9"))+d(o.goods_cost),1)]),_:2},1024),t(f,{caption:""},{default:n(()=>[r(d(e.$t("notice.mobile_asn.notice10"))+d(o.goods_actual_qty-o.sorted_qty),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),z(t(Y,{spaced:"",inset:"item"},null,512),[[ye,c+1!==e.tablelist.length]])],64))),128))]),_:1}),t(re,{modelValue:e.dialogForm,"onUpdate:modelValue":l[4]||(l[4]=o=>e.dialogForm=o)},{default:n(()=>[t(me,{class:"shadow-24"},{default:n(()=>[t(Ce,{class:"bg-light-blue-10 text-white rounded-borders",style:{height:"50px"}},{default:n(()=>[Z("div",null,d(e.submitdata.goods_code),1),t(Se),z((N(),pe(I,{dense:"",flat:"",icon:"close"},{default:n(()=>[t(Qe,null,{default:n(()=>[r(d(e.$t("index.close")),1)]),_:1})]),_:1})),[[$e]])]),_:1}),t(fe,{class:"scroll"},{default:n(()=>[t(be,{dense:"",outlined:"",square:"",debounce:"500",modelValue:e.submitdata.qty,"onUpdate:modelValue":l[2]||(l[2]=o=>e.submitdata.qty=o),modelModifiers:{number:!0},type:"number",label:e.$t("stock.view_stocklist.goods_qty"),style:{"margin-bottom":"5px"},onClick:l[3]||(l[3]=o=>e.submitdata.qty=""),rules:[o=>o&&o>0||e.moveerror]},{before:n(()=>[t(De,{dense:"",outlined:"",square:"","use-input":"","hide-selected":"","fill-input":"",modelValue:e.submitdata.bin_name,"onUpdate:modelValue":l[1]||(l[1]=o=>e.submitdata.bin_name=o),label:e.$t("warehouse.view_binset.bin_name"),options:e.options,onFilter:e.filterFn,style:{width:"150px"}},ve({"no-option":n(()=>[t(A,null,{default:n(()=>[t(V,{class:"text-grey"},{default:n(()=>[r(" No results ")]),_:1})]),_:1})]),_:2},[e.submitdata.bin_name?{name:"append",fn:n(()=>[t(he,{name:"cancel",onClick:l[0]||(l[0]=_e(o=>e.submitdata.bin_name="",["stop"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","label","options","onFilter"])]),_:1},8,["modelValue","label","rules"])]),_:1}),Z("div",Ne,[t(I,{color:"white","text-color":"black",style:{"margin-right":"25px"},onClick:e.cancelDataSubmit},{default:n(()=>[r(d(e.$t("cancel")),1)]),_:1},8,["onClick"]),t(I,{color:"primary",onClick:e.submitData},{default:n(()=>[r(d(e.$t("submit")),1)]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["modelValue"])],64)}var We=le(we,[["render",qe]]);export{We as default};
