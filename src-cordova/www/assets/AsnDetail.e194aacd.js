import{Q as p}from"./QItemLabel.8b351527.js";import{Q as oe,a as A,b as w}from"./QList.5473fc14.js";import{_ as le,aC as ie,J as ue,aR as de,r as _,c as s,w as k,o as ce,M as N,Y as T,f as t,R as n,aS as re,F as B,W as r,X as c,$ as Y,Z as ge,aT as me,V as Z,S as z,O as fe,m as I,aU as pe,aD as be,aV as ve,Q as he,aW as _e,a1 as ye}from"./index.1785b037.js";import{Q as Se,a as Ce,b as Qe}from"./QBar.e59c6e1d.js";import{Q as De}from"./QSelect.b67bef98.js";import{C as $e}from"./ClosePopup.281b2b30.js";import{u as Ve}from"./use-quasar.8d75fc37.js";import{a as O}from"./index.2885cb15.js";import{u as we}from"./vue-i18n.runtime.esm-bundler.ec1d6f08.js";import"./selection.d3e7cd02.js";import"./QMenu.8de0ba52.js";import"./rtl.b51694b1.js";import"./format.a33550d6.js";const ke=ie({name:"ASNDetail",data(){return{}},setup(){const e=ue();de();const i=Ve(),b=_(0),m=_({}),y=_(!1),S=_([]),o=_(""),{t:d}=we(),U=s({get:()=>e.state.fabchange.fab1}),H=s({get:()=>e.state.fabchange.fab2}),K=s({get:()=>e.state.fabchange.fab3}),x=s({get:()=>e.state.fabchange.fab4}),E=s({get:()=>e.state.screenchange.screenscroll}),q=s({get:()=>e.state.loginauth.authin}),ee=s({get:()=>e.state.loginauth.login_name}),C=s({get:()=>e.state.loginauth.operator}),Q=s({get:()=>e.state.settings.openid}),D=s({get:()=>e.state.langchange.lang}),v=s({get:()=>e.state.settings.server}),M=s({get:()=>e.state.scanchanged.scandata,set:a=>{e.commit("scanchanged/ScanChanged",a)}}),ae=s({get:()=>e.state.scanchanged.datadetail,set:a=>{e.commit("scanchanged/ScanDataChanged",a)}}),j=s({get:()=>e.state.scanchanged.asndata,set:a=>{e.commit("scanchanged/ASNDataChanged",a)}}),te=s({get:()=>e.state.scanchanged.dndata,set:a=>{e.commit("scanchanged/DNDataChanged",a)}}),ne=s({get:()=>e.state.scanchanged.bindata,set:a=>{e.commit("scanchanged/BinDataChanged",a)}}),h=s({get:()=>e.state.scanchanged.tablelist,set:a=>{e.commit("scanchanged/TableDataChanged",a)}}),$=s({get:()=>e.state.scanchanged.scanmode,set:a=>{e.commit("scanchanged/ScanModeChanged",a)}}),L=s({get:()=>e.state.scanchanged.bar_scanned}),g=s({get:()=>e.state.scanchanged.apiurl,set:a=>{e.commit("scanchanged/ApiUrlChanged",a)}}),V=s({get:()=>e.state.scanchanged.apiurlnext,set:a=>{e.commit("scanchanged/ApiUrlNextChanged",a)}}),J=s({get:()=>e.state.scanchanged.apiurlprevious,set:a=>{e.commit("scanchanged/ApiUrlPreviousChanged",a)}});function R(a){if(a!==null){var l=v.value.split(":"),u=a.split(":");if(u.length===2)return l[0]!==u[0]?l[0]+":"+u[1]:a;if(u.length===3)return l[0]!==u[0]?l[0]+":"+u[1]+":"+u[2]:a}else return null}function F(a){h.value=[],g.value=v.value+"/asn/detail/?asn_status=4&asn_code="+j.value,P(a)}function P(a){O.get(g.value+a,{headers:{"Content-Type":'application/json, charset="utf-8"',token:Q.value,language:D.value,operator:C.value}}).then(l=>{if(l.data.detail)i.notify({type:"negative",message:d("notice.mobile_scan.notice1")});else{var u=[];h.value.forEach(f=>{u.push(f)}),l.data.results.forEach(f=>{u.push(f)}),h.value=u,J.value=R(l.data.previous),V.value=R(l.data.next)}}).catch(l=>{i.notify({type:"negative",message:d("notice.mobile_scan.notice3")})})}function W(a){m.value=JSON.parse(JSON.stringify(a)),Object.assign(m.value,{qty:"",bin_name:""}),y.value=!0}function G(){y.value=!1}function se(){m.value.bin_name===""?i.notify({type:"negative",message:d("notice.mobile_asn.notice13")}):(g.value=v.value+"/asn/movetobin/",O.post(g.value+m.value.id+"/",m.value,{headers:{"Content-Type":"application/json",token:Q.value,language:D.value,operator:C.value}}).then(a=>{a.data.detail||i.notify({message:d("notice.mobile_asn.notice12")}),G(),F("")}).catch(a=>{i.notify({message:d("notice.network_error")})}))}function X(a){g.value=v.value+"/binset/?bin_name__icontains=",O.get(g.value+a,{headers:{"Content-Type":'application/json, charset="utf-8"',token:Q.value,language:D.value,operator:C.value}}).then(l=>{if(!l.data.detail){var u=[];S.value=[],l.data.results.forEach(f=>{u.push(f.bin_name)}),S.value=u}}).catch(l=>{i.notify({type:"negative",message:d("notice.mobile_scan.notice3")})})}return k(o,(a,l)=>{a.length>=2&&X(a)}),k(L,(a,l)=>{$.value==="GOODS"?h.value.forEach(u=>{u.goods_code===M.value&&W(u)}):$.value==="ASN"&&F("")}),k(E,(a,l)=>{a===1?V.value!==null&&(g.value=V.value,b.value=1):b.value=0}),k(b,(a,l)=>{a===1&&(q.value==="0"?i.notify({type:"negative",message:d("notice.mobile_userlogin.notice9")}):P(""))}),ce(()=>{q.value==="0"?i.notify({type:"negative",message:d("notice.mobile_userlogin.notice9")}):($.value="ASN",F(""))}),{t:d,fab1:U,fab2:H,fab3:K,fab4:x,screenscroll:E,authin:q,login_name:ee,openid:Q,operator:C,lang:D,requestauth:b,baseurl:v,apiurl:g,apiurlnext:V,apiurlprevious:J,scandata:M,datadetail:ae,tablelist:h,asndata:j,dndata:te,bindata:ne,scanmode:$,bar_scanned:L,submitdata:m,dialogForm:y,dataSubmit:W,cancelDataSubmit:G,submitData:se,options:S,optionsChange:o,moveerror:d("notice.mobile_asn.notice11"),setOptions:X,filterFn(a,l,u){if(a.length<2){u();return}l(()=>{const f=a.toLowerCase();o.value=f})}}}}),Ne={style:{float:"right",padding:"15px 15px 15px 0"}};function qe(e,i,b,m,y,S){return N(),T(B,null,[t(oe,{bordered:"",padding:""},{default:n(()=>[t(A,null,{default:n(()=>[t(w,null,{default:n(()=>[t(p,{overline:""},{default:n(()=>[r(c(e.$t("notice.mobile_asn.notice6")),1)]),_:1}),t(p,{caption:""},{default:n(()=>[r(c(e.$t("notice.mobile_asn.notice7")),1)]),_:1})]),_:1})]),_:1}),t(Y,{spaced:""}),(N(!0),T(B,null,ge(e.tablelist,(o,d)=>(N(),T(B,{key:d},[t(A,null,{default:n(()=>[t(w,{onClick:U=>e.dataSubmit(o)},{default:n(()=>[t(p,null,{default:n(()=>[r(c(o.asn_code),1)]),_:2},1024),t(p,{caption:"",lines:"2"},{default:n(()=>[r(c(o.goods_code),1)]),_:2},1024)]),_:2},1032,["onClick"]),t(w,{side:"",top:""},{default:n(()=>[t(p,{caption:""},{default:n(()=>[r(c(e.$t("notice.mobile_asn.notice9"))+c(o.goods_cost),1)]),_:2},1024),t(p,{caption:""},{default:n(()=>[r(c(e.$t("notice.mobile_asn.notice10"))+c(o.goods_actual_qty-o.sorted_qty),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),z(t(Y,{spaced:"",inset:"item"},null,512),[[ye,d+1!==e.tablelist.length]])],64))),128))]),_:1}),t(re,{modelValue:e.dialogForm,"onUpdate:modelValue":i[4]||(i[4]=o=>e.dialogForm=o)},{default:n(()=>[t(me,{class:"shadow-24"},{default:n(()=>[t(Se,{class:"bg-light-blue-10 text-white rounded-borders",style:{height:"50px"}},{default:n(()=>[Z("div",null,c(e.submitdata.goods_code),1),t(Ce),z((N(),fe(I,{dense:"",flat:"",icon:"close"},{default:n(()=>[t(Qe,null,{default:n(()=>[r(c(e.$t("index.close")),1)]),_:1})]),_:1})),[[$e]])]),_:1}),t(pe,{class:"scroll"},{default:n(()=>[t(be,{dense:"",outlined:"",square:"",debounce:"500",modelValue:e.submitdata.qty,"onUpdate:modelValue":i[2]||(i[2]=o=>e.submitdata.qty=o),modelModifiers:{number:!0},type:"number",label:e.$t("stock.view_stocklist.goods_qty"),style:{"margin-bottom":"5px"},onClick:i[3]||(i[3]=o=>e.submitdata.qty=""),rules:[o=>o&&o>0||e.moveerror]},{before:n(()=>[t(De,{dense:"",outlined:"",square:"","use-input":"","hide-selected":"","fill-input":"",modelValue:e.submitdata.bin_name,"onUpdate:modelValue":i[1]||(i[1]=o=>e.submitdata.bin_name=o),label:e.$t("warehouse.view_binset.bin_name"),options:e.options,onFilter:e.filterFn,style:{width:"150px"}},ve({"no-option":n(()=>[t(A,null,{default:n(()=>[t(w,{class:"text-grey"},{default:n(()=>[r(" No results ")]),_:1})]),_:1})]),_:2},[e.submitdata.bin_name?{name:"append",fn:n(()=>[t(he,{name:"cancel",onClick:i[0]||(i[0]=_e(o=>e.submitdata.bin_name="",["stop"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","label","options","onFilter"])]),_:1},8,["modelValue","label","rules"])]),_:1}),Z("div",Ne,[t(I,{color:"white","text-color":"black",style:{"margin-right":"25px"},onClick:e.cancelDataSubmit},{default:n(()=>[r(c(e.$t("cancel")),1)]),_:1},8,["onClick"]),t(I,{color:"primary",onClick:e.submitData},{default:n(()=>[r(c(e.$t("submit")),1)]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["modelValue"])],64)}var Pe=le(ke,[["render",qe]]);export{Pe as default};
