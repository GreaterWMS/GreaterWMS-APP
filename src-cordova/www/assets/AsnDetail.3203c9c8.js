import{Q as g}from"./QItemLabel.f2ca9cdb.js";import{Q as le,a as F,b as k}from"./QList.d1851a4f.js";import{_ as ie,az as ue,J as de,aP as ce,r as D,c as o,w as B,o as re,M as V,V as T,f as t,R as s,aR as me,F as U,S as c,U as u,X as H,W as ge,aS as fe,Y as K,$ as Z,O as pe,m as I,aT as be,aB as ve,aU as he,Q as _e,aV as ye,aA as Ce}from"./index.dfd0e5e3.js";import{Q as Se,a as Qe,b as $e}from"./QBar.136bca6b.js";import{Q as ke}from"./QSelect.5f57161a.js";import{C as De}from"./ClosePopup.ea049126.js";import{u as Ve}from"./use-quasar.144b8dba.js";import{a as O}from"./index.2885cb15.js";import{u as we}from"./vue-i18n.runtime.esm-bundler.c4f8fc63.js";import"./selection.e5845525.js";import"./QMenu.30ec175d.js";import"./rtl.b51694b1.js";import"./format.a33550d6.js";const Ne=ue({name:"ASNDetail",data(){return{}},setup(){const e=de();ce();const l=Ve(),f=D(0),m=D({}),h=D(!1),w=D([]),{t:n}=we(),_=o({get:()=>e.state.fabchange.fab1}),E=o({get:()=>e.state.fabchange.fab2}),x=o({get:()=>e.state.fabchange.fab3}),ee=o({get:()=>e.state.fabchange.fab4}),L=o({get:()=>e.state.screenchange.screenscroll}),M=o({get:()=>e.state.loginauth.authin}),ae=o({get:()=>e.state.loginauth.login_name}),y=o({get:()=>e.state.loginauth.operator}),C=o({get:()=>e.state.settings.openid}),S=o({get:()=>e.state.langchange.lang}),p=o({get:()=>e.state.settings.server}),j=o({get:()=>e.state.scanchanged.scandata,set:a=>{e.commit("scanchanged/ScanChanged",a)}}),te=o({get:()=>e.state.scanchanged.datadetail,set:a=>{e.commit("scanchanged/ScanDataChanged",a)}}),J=o({get:()=>e.state.scanchanged.asndata,set:a=>{e.commit("scanchanged/ASNDataChanged",a)}}),ne=o({get:()=>e.state.scanchanged.dndata,set:a=>{e.commit("scanchanged/DNDataChanged",a)}}),se=o({get:()=>e.state.scanchanged.bindata,set:a=>{e.commit("scanchanged/BinDataChanged",a)}}),b=o({get:()=>e.state.scanchanged.tablelist,set:a=>{e.commit("scanchanged/TableDataChanged",a)}}),Q=o({get:()=>e.state.scanchanged.scanmode,set:a=>{e.commit("scanchanged/ScanModeChanged",a)}}),P=o({get:()=>e.state.scanchanged.bar_scanned}),r=o({get:()=>e.state.scanchanged.apiurl,set:a=>{e.commit("scanchanged/ApiUrlChanged",a)}}),$=o({get:()=>e.state.scanchanged.apiurlnext,set:a=>{e.commit("scanchanged/ApiUrlNextChanged",a)}}),R=o({get:()=>e.state.scanchanged.apiurlprevious,set:a=>{e.commit("scanchanged/ApiUrlPreviousChanged",a)}});function z(a){if(a!==null){var i=p.value.split(":"),d=a.split(":");return i[0]!==d[0]?i[0]+":"+d[1]:d}else return null}function N(a){b.value=[],r.value=p.value+"asn/detail/?asn_code="+J.value,G(a)}function G(a){O.get(r.value+a,{headers:{"Content-Type":'application/json, charset="utf-8"',token:C.value,language:S.value,operator:y.value}}).then(i=>{if(i.data.detail)l.notify({type:"negative",message:n("notice.mobile_scan.notice1")});else{var d=[];b.value.forEach(v=>{d.push(v)}),i.data.results.forEach(v=>{d.push(v)}),b.value=d,R.value=z(i.data.previous),$.value=z(i.data.next)}}).catch(i=>{l.notify({type:"negative",message:n("notice.mobile_scan.notice3")})})}function W(a){m.value=JSON.parse(JSON.stringify(a)),Object.assign(m.value,{qty:"",bin_name:""}),h.value=!0}function X(){h.value=!1}function oe(){m.value.bin_name===""?l.notify({type:"negative",message:n("notice.mobile_asn.notice13")}):(r.value=p.value+"asn/movetobin/",O.post(r.value+m.value.id+"/",m.value,{headers:{"Content-Type":"application/json",token:C.value,language:S.value,operator:y.value}}).then(a=>{a.data.detail||l.notify({message:n("notice.mobile_asn.notice12")}),X(),N("")}).catch(a=>{l.notify({message:n("notice.network_error")})}))}return B(P,(a,i)=>{Q.value==="GOODS"?b.value.forEach(d=>{d.goods_code===j.value&&W(d)}):Q.value==="ASN"&&N("")}),B(L,(a,i)=>{a===1?$.value!==null&&(r.value=$.value,f.value=1):f.value=0}),B(f,(a,i)=>{a===1&&(M.value==="0"?l.notify({type:"negative",message:n("notice.mobile_userlogin.notice9")}):G(""))}),re(()=>{Q.value="ASN",N("")}),{t:n,fab1:_,fab2:E,fab3:x,fab4:ee,screenscroll:L,authin:M,login_name:ae,openid:C,operator:y,lang:S,requestauth:f,baseurl:p,apiurl:r,apiurlnext:$,apiurlprevious:R,scandata:j,datadetail:te,tablelist:b,asndata:J,dndata:ne,bindata:se,scanmode:Q,bar_scanned:P,submitdata:m,dialogForm:h,dataSubmit:W,cancelDataSubmit:X,submitData:oe,options:w,moveerror:n("notice.mobile_asn.notice11"),filterFn(a,i,d){if(a.length<2){d();return}i(()=>{const v=a.toLowerCase();r.value=p.value+"binset/?bin_name__icontains=",O.get(r.value+a,{headers:{"Content-Type":'application/json, charset="utf-8"',token:C.value,language:S.value,operator:y.value}}).then(q=>{if(!q.data.detail){var Y=[];q.data.results.forEach(A=>{Y.push(A.bin_name)}),w.value=Y.filter(A=>A.toLowerCase().indexOf(v)>-1)}}).catch(q=>{l.notify({type:"negative",message:n("notice.mobile_scan.notice3")})})})}}}}),qe={style:{float:"right",padding:"15px 15px 15px 0"}};function Ae(e,l,f,m,h,w){return V(),T(U,null,[t(le,{bordered:"",padding:""},{default:s(()=>[t(F,null,{default:s(()=>[t(k,null,{default:s(()=>[t(g,{overline:""},{default:s(()=>[c(u(e.$t("notice.mobile_asn.notice6")),1)]),_:1}),t(g,{caption:""},{default:s(()=>[c(u(e.$t("notice.mobile_asn.notice7")),1)]),_:1})]),_:1})]),_:1}),t(H,{spaced:""}),t(g,{header:""},{default:s(()=>[c(u(e.asndata),1)]),_:1}),(V(!0),T(U,null,ge(e.tablelist,(n,_)=>(V(),T(U,{key:_},[t(F,null,{default:s(()=>[t(k,{onClick:E=>e.dataSubmit(n)},{default:s(()=>[t(g,null,{default:s(()=>[c(u(n.asn_code),1)]),_:2},1024),t(g,{caption:"",lines:"2"},{default:s(()=>[c(u(n.goods_code),1)]),_:2},1024)]),_:2},1032,["onClick"]),t(k,{side:"",top:""},{default:s(()=>[t(g,{caption:""},{default:s(()=>[c(u(e.$t("notice.mobile_asn.notice9"))+u(n.goods_cost),1)]),_:2},1024),t(g,{caption:""},{default:s(()=>[c(u(e.$t("notice.mobile_asn.notice10"))+u(n.goods_actual_qty-n.sorted_qty),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),Z(t(H,{spaced:"",inset:"item"},null,512),[[Ce,_+1!==e.tablelist.length]])],64))),128))]),_:1}),t(me,{modelValue:e.dialogForm,"onUpdate:modelValue":l[4]||(l[4]=n=>e.dialogForm=n)},{default:s(()=>[t(fe,{class:"shadow-24"},{default:s(()=>[t(Se,{class:"bg-light-blue-10 text-white rounded-borders",style:{height:"50px"}},{default:s(()=>[K("div",null,u(e.submitdata.goods_code),1),t(Qe),Z((V(),pe(I,{dense:"",flat:"",icon:"close"},{default:s(()=>[t($e,null,{default:s(()=>[c(u(e.$t("index.close")),1)]),_:1})]),_:1})),[[De]])]),_:1}),t(be,{class:"scroll"},{default:s(()=>[t(ve,{dense:"",outlined:"",square:"",debounce:"500",modelValue:e.submitdata.qty,"onUpdate:modelValue":l[2]||(l[2]=n=>e.submitdata.qty=n),modelModifiers:{number:!0},type:"number",label:e.$t("stock.view_stocklist.goods_qty"),style:{"margin-bottom":"5px"},onClick:l[3]||(l[3]=n=>e.submitdata.qty=""),rules:[n=>n&&n>0||e.moveerror]},{before:s(()=>[t(ke,{dense:"",outlined:"",square:"","use-input":"","hide-selected":"","fill-input":"",modelValue:e.submitdata.bin_name,"onUpdate:modelValue":l[1]||(l[1]=n=>e.submitdata.bin_name=n),label:e.$t("warehouse.view_binset.bin_name"),options:e.options,onFilter:e.filterFn,style:{width:"150px"}},he({"no-option":s(()=>[t(F,null,{default:s(()=>[t(k,{class:"text-grey"},{default:s(()=>[c(" No results ")]),_:1})]),_:1})]),_:2},[e.submitdata.bin_name?{name:"append",fn:s(()=>[t(_e,{name:"cancel",onClick:l[0]||(l[0]=ye(n=>e.submitdata.bin_name="",["stop"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","label","options","onFilter"])]),_:1},8,["modelValue","label","rules"])]),_:1}),K("div",qe,[t(I,{color:"white","text-color":"black",style:{"margin-right":"25px"},onClick:e.cancelDataSubmit},{default:s(()=>[c(u(e.$t("cancel")),1)]),_:1},8,["onClick"]),t(I,{color:"primary",onClick:e.submitData},{default:s(()=>[c(u(e.$t("submit")),1)]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["modelValue"])],64)}var ze=ie(Ne,[["render",Ae]]);export{ze as default};
