import{Q as g}from"./QItemLabel.f2ca9cdb.js";import{Q as ie,a as F,b as D}from"./QList.d1851a4f.js";import{_ as le,az as ce,J as ue,aP as de,r as V,c as s,w as N,o as re,M as w,V as T,f as t,R as o,aR as me,F as U,S as u,U as c,X,W as ge,aS as pe,Y,$ as H,O as fe,m as I,aT as be,aB as ve,aU as he,Q as _e,aV as ye,aA as ke}from"./index.dfd0e5e3.js";import{Q as Ce,a as Se,b as Qe}from"./QBar.136bca6b.js";import{Q as $e}from"./QSelect.5f57161a.js";import{C as De}from"./ClosePopup.ea049126.js";import{u as Ve}from"./use-quasar.144b8dba.js";import{a as A}from"./index.2885cb15.js";import{u as we}from"./vue-i18n.runtime.esm-bundler.c4f8fc63.js";import"./selection.e5845525.js";import"./QMenu.30ec175d.js";import"./rtl.b51694b1.js";import"./format.a33550d6.js";const Oe=ce({name:"BinStock",data(){return{}},setup(){const e=ue();de();const i=Ve(),p=V(0),m=V({}),v=V(!1),O=V([]),{t:n}=we(),h=s({get:()=>e.state.fabchange.fab1}),L=s({get:()=>e.state.fabchange.fab2}),K=s({get:()=>e.state.fabchange.fab3}),Z=s({get:()=>e.state.fabchange.fab4}),M=s({get:()=>e.state.screenchange.screenscroll}),j=s({get:()=>e.state.loginauth.authin}),x=s({get:()=>e.state.loginauth.login_name}),_=s({get:()=>e.state.loginauth.operator}),y=s({get:()=>e.state.settings.openid}),k=s({get:()=>e.state.langchange.lang}),f=s({get:()=>e.state.settings.server}),E=s({get:()=>e.state.scanchanged.scandata,set:a=>{e.commit("scanchanged/ScanChanged",a)}}),ee=s({get:()=>e.state.scanchanged.datadetail,set:a=>{e.commit("scanchanged/ScanDataChanged",a)}}),ae=s({get:()=>e.state.scanchanged.asndata,set:a=>{e.commit("scanchanged/ASNDataChanged",a)}}),te=s({get:()=>e.state.scanchanged.dndata,set:a=>{e.commit("scanchanged/DNDataChanged",a)}}),ne=s({get:()=>e.state.scanchanged.bindata,set:a=>{e.commit("scanchanged/BinDataChanged",a)}}),C=s({get:()=>e.state.scanchanged.tablelist,set:a=>{e.commit("scanchanged/TableDataChanged",a)}}),S=s({get:()=>e.state.scanchanged.scanmode,set:a=>{e.commit("scanchanged/ScanModeChanged",a)}}),G=s({get:()=>e.state.scanchanged.bar_scanned}),r=s({get:()=>e.state.scanchanged.apiurl,set:a=>{e.commit("scanchanged/ApiUrlChanged",a)}}),Q=s({get:()=>e.state.scanchanged.apiurlnext,set:a=>{e.commit("scanchanged/ApiUrlNextChanged",a)}}),J=s({get:()=>e.state.scanchanged.apiurlprevious,set:a=>{e.commit("scanchanged/ApiUrlPreviousChanged",a)}});function P(a){if(a!==null){var l=f.value.split(":"),d=a.split(":");return l[0]!==d[0]?l[0]+":"+d[1]:d}else return null}function $(a){C.value=[],r.value=f.value+"stock/bin/?goods_code=",R(a)}function R(a){A.get(r.value+a,{headers:{"Content-Type":'application/json, charset="utf-8"',token:y.value,language:k.value,operator:_.value}}).then(l=>{if(l.data.detail)i.notify({type:"negative",message:n("notice.mobile_scan.notice1")});else{var d=[];C.value.forEach(b=>{d.push(b)}),l.data.results.forEach(b=>{d.push(b)}),C.value=d,J.value=P(l.data.previous),Q.value=P(l.data.next)}}).catch(l=>{i.notify({type:"negative",message:n("notice.mobile_scan.notice3")})})}function oe(a){m.value=JSON.parse(JSON.stringify(a)),Object.assign(m.value,{move_qty:"",move_to_bin:""}),v.value=!0}function z(){v.value=!1}function se(){m.value.move_to_bin===""?i.notify({type:"negative",message:n("notice.mobile_binstock.notice5")}):(r.value=f.value+"stock/bin/",A.post(r.value+m.value.id+"/",m.value,{headers:{"Content-Type":"application/json",token:y.value,language:k.value,operator:_.value}}).then(a=>{z(),$(""),a.data.detail||i.notify({message:n("notice.mobile_binstock.notice6")})}).catch(a=>{i.notify({message:n("notice.network_error")})}))}return N(G,(a,l)=>{S.value==="GOODS"&&$("")}),N(M,(a,l)=>{a===1?Q.value!==null&&(r.value=Q.value,p.value=1):p.value=0}),N(p,(a,l)=>{a===1&&(j.value==="0"?i.notify({type:"negative",message:n("notice.mobile_userlogin.notice9")}):R(""))}),re(()=>{S.value==="GOODS"?$(E.value):(S.value="GOODS",$(""))}),{t:n,fab1:h,fab2:L,fab3:K,fab4:Z,screenscroll:M,authin:j,login_name:x,openid:y,operator:_,lang:k,requestauth:p,baseurl:f,apiurl:r,apiurlnext:Q,apiurlprevious:J,scandata:E,datadetail:ee,tablelist:C,asndata:ae,dndata:te,bindata:ne,scanmode:S,bar_scanned:G,submitdata:m,dialogForm:v,dataSubmit:oe,cancelDataSubmit:z,submitData:se,options:O,moveerror:n("notice.mobile_asn.notice11"),filterFn(a,l,d){if(a.length<2){d();return}l(()=>{const b=a.toLowerCase();r.value=f.value+"binset/?bin_name__icontains=",A.get(r.value+a,{headers:{"Content-Type":'application/json, charset="utf-8"',token:y.value,language:k.value,operator:_.value}}).then(q=>{if(!q.data.detail){var W=[];q.data.results.forEach(B=>{W.push(B.bin_name)}),O.value=W.filter(B=>B.toLowerCase().indexOf(b)>-1)}}).catch(q=>{i.notify({type:"negative",message:n("notice.mobile_scan.notice3")})})})}}}}),qe={style:{float:"right",padding:"15px 15px 15px 0"}};function Be(e,i,p,m,v,O){return w(),T(U,null,[t(ie,{bordered:"",padding:""},{default:o(()=>[t(F,null,{default:o(()=>[t(D,null,{default:o(()=>[t(g,{overline:""},{default:o(()=>[u(c(e.$t("notice.mobile_binstock.notice1")),1)]),_:1}),t(g,{caption:""},{default:o(()=>[u(c(e.$t("notice.mobile_binstock.notice2")),1)]),_:1})]),_:1})]),_:1}),t(X,{spaced:""}),(w(!0),T(U,null,ge(e.tablelist,(n,h)=>(w(),T(U,{key:h},[t(F,null,{default:o(()=>[t(D,{onClick:L=>e.dataSubmit(n)},{default:o(()=>[t(g,null,{default:o(()=>[u(c(n.goods_code),1)]),_:2},1024),t(g,{caption:"",lines:"2"},{default:o(()=>[u(c(n.goods_desc),1)]),_:2},1024)]),_:2},1032,["onClick"]),t(D,{side:"",top:""},{default:o(()=>[t(g,{caption:""},{default:o(()=>[u(c(e.$t("notice.mobile_binstock.notice3"))+c(n.bin_name),1)]),_:2},1024),t(g,{caption:""},{default:o(()=>[u(c(e.$t("notice.mobile_binstock.notice4"))+c(n.goods_qty),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),H(t(X,{spaced:"",inset:"item"},null,512),[[ke,h+1!==e.tablelist.length]])],64))),128))]),_:1}),t(me,{modelValue:e.dialogForm,"onUpdate:modelValue":i[4]||(i[4]=n=>e.dialogForm=n)},{default:o(()=>[t(pe,{class:"shadow-24"},{default:o(()=>[t(Ce,{class:"bg-light-blue-10 text-white rounded-borders",style:{height:"50px"}},{default:o(()=>[Y("div",null,c(e.submitdata.goods_code),1),t(Se),H((w(),fe(I,{dense:"",flat:"",icon:"close"},{default:o(()=>[t(Qe,null,{default:o(()=>[u(c(e.$t("index.close")),1)]),_:1})]),_:1})),[[De]])]),_:1}),t(be,{class:"scroll"},{default:o(()=>[t(ve,{dense:"",outlined:"",square:"",debounce:"500",modelValue:e.submitdata.move_qty,"onUpdate:modelValue":i[2]||(i[2]=n=>e.submitdata.move_qty=n),modelModifiers:{number:!0},type:"number",label:e.$t("stock.view_stocklist.goods_qty"),style:{"margin-bottom":"5px"},onClick:i[3]||(i[3]=n=>e.submitdata.move_qty=""),rules:[n=>n&&n>0||e.moveerror]},{before:o(()=>[t($e,{dense:"",outlined:"",square:"","use-input":"","hide-selected":"","fill-input":"",modelValue:e.submitdata.move_to_bin,"onUpdate:modelValue":i[1]||(i[1]=n=>e.submitdata.move_to_bin=n),label:e.$t("warehouse.view_binset.bin_name"),options:e.options,onFilter:e.filterFn,style:{width:"150px"}},he({"no-option":o(()=>[t(F,null,{default:o(()=>[t(D,{class:"text-grey"},{default:o(()=>[u(" No results ")]),_:1})]),_:1})]),_:2},[e.submitdata.move_to_bin?{name:"append",fn:o(()=>[t(_e,{name:"cancel",onClick:i[0]||(i[0]=ye(n=>e.submitdata.move_to_bin="",["stop"])),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","label","options","onFilter"])]),_:1},8,["modelValue","label","rules"])]),_:1}),Y("div",qe,[t(I,{color:"white","text-color":"black",style:{"margin-right":"25px"},onClick:e.cancelDataSubmit},{default:o(()=>[u(c(e.$t("cancel")),1)]),_:1},8,["onClick"]),t(I,{color:"primary",onClick:e.submitData},{default:o(()=>[u(c(e.$t("submit")),1)]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["modelValue"])],64)}var Re=le(Oe,[["render",Be]]);export{Re as default};
